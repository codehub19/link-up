import{r,j as s,D as y,E as j,G as f,H as v,m as w,d as b}from"./index-D1459Nzo.js";import{A as N}from"./AdminGuard-p0RkhqR3.js";import{A as I}from"./AdminHeader-P52REjaF.js";function S(){const[p,h]=r.useState([]),[o,d]=r.useState(!1),[i,c]=r.useState(null),[t,g]=r.useState("");async function x(e){c(e);try{await j(e),alert("Approved and subscription provisioned"),await l()}catch(n){console.error("approve error",n),alert((n==null?void 0:n.message)||"Failed to approve")}finally{c(null)}}async function l(){d(!0);try{const e=await f(),n=await Promise.all(e.map(async u=>{const a=(await v(w(b,"users",u.uid))).data()||{};return{...u,userName:(a==null?void 0:a.name)||"User",gender:(a==null?void 0:a.gender)||"-",instagramId:(a==null?void 0:a.instagramId)||""}}));h(n)}finally{d(!1)}}r.useEffect(()=>{l()},[]);const m=p.filter(e=>(e.userName||"").toLowerCase().includes(t.toLowerCase())||(e.instagramId||"").toLowerCase().includes(t.toLowerCase())||(e.planId||"").toLowerCase().includes(t.toLowerCase()));return s.jsx(N,{children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"card",style:{padding:24,margin:"24px auto",maxWidth:1e3},children:[s.jsx(I,{current:"payments"}),s.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h2",{style:{marginTop:0},children:"Payments (Pending)"}),s.jsx("input",{className:"input",placeholder:"Search name/insta/plan…",value:t,onChange:e=>g(e.target.value),style:{maxWidth:260}})]}),o?s.jsx("p",{children:"Loading…"}):null,s.jsxs("div",{className:"stack",children:[m.map(e=>s.jsx("div",{className:"card",style:{padding:16},children:s.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12,flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("b",{children:e.userName})," • ",e.gender," ",e.instagramId?s.jsxs("span",{className:"muted",children:["(@",e.instagramId,")"]}):null]}),s.jsxs("div",{style:{color:"var(--muted)",fontSize:13},children:["Plan: ",e.planId," • Amount: ₹",e.amount," • UPI: ",e.upiId]}),e.proofUrl?s.jsx("div",{style:{marginTop:6},children:s.jsx("a",{href:e.proofUrl,target:"_blank",rel:"noreferrer",children:"View proof"})}):null]}),s.jsxs("div",{className:"row",style:{gap:8},children:[s.jsx("button",{className:"btn btn-primary",disabled:i===e.id,onClick:()=>x(e.id),children:i===e.id?"Approving…":"Approve"}),s.jsx("button",{className:"btn btn-ghost",disabled:i===e.id,onClick:async()=>{await y(e.id),await l()},children:"Reject"})]})]})},e.id)),m.length===0&&!o?s.jsx("p",{style:{color:"var(--muted)"},children:"No pending payments."}):null]})]})})})}export{S as default};
