import{u as B,a as F,r,q as I,w as M,c as L,o as q,j as s,N as R,l as D,g as G,b as Q,d as T}from"./index-D1459Nzo.js";import{M as $}from"./MaleTabs-DW5qi8ga.js";function p(t){return(t||"").toLowerCase().trim().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"")}function U(){var b,f;const{user:t}=B(),u=F(),[g,E]=r.useState([]),[c,C]=r.useState(null),[P,j]=r.useState(!0),[x,w]=r.useState({});r.useEffect(()=>{(async()=>{j(!0);try{const[a,l]=await Promise.all([D(),t?G(t.uid):Promise.resolve(null)]);E(a),C(l)}catch(a){Q.error(a.message??"Failed to load plans")}finally{j(!1)}})()},[t]),r.useEffect(()=>{if(!t)return;const e=I(L(T,"payments"),M("uid","==",t.uid)),a=q(e,l=>{const n={};l.forEach(o=>{var d,N;const m=o.data(),y=m.planId||"";if(!y)return;const h=p(y),k=m.status??"pending",v=((N=(d=m.updatedAt)==null?void 0:d.toMillis)==null?void 0:N.call(d))??Date.now();(!n[h]||v>n[h].ts)&&(n[h]={status:k,ts:v})});const i={};Object.keys(n).forEach(o=>i[o]=n[o].status),w(i)});return()=>a()},[t]);const A=e=>{u(`/pay?planId=${encodeURIComponent(e.id)}&amount=${Number(e.price||e.amount||0)}`)},S=e=>{const a=x[p(e)];return a?a==="pending"?s.jsx("span",{className:"tag",style:{background:"#FEF3C7",color:"#92400E"},children:"Pending"}):a==="approved"?s.jsx("span",{className:"tag",style:{background:"#DCFCE7",color:"#166534"},children:"Confirmed"}):a==="rejected"?s.jsx("span",{className:"tag",style:{background:"#FEE2E2",color:"#991B1B"},children:"Rejected"}):a==="failed"?s.jsx("span",{className:"tag",style:{background:"#FEE2E2",color:"#991B1B"},children:"Failed"}):null:null};return s.jsxs(s.Fragment,{children:[s.jsx(R,{}),s.jsxs("div",{className:"container",children:[s.jsx($,{}),c?s.jsxs("div",{className:"banner",style:{marginBottom:16},children:["Current plan: ",s.jsx("b",{children:((b=c.plan)==null?void 0:b.name)??c.planId})," • Remaining matches: ",s.jsx("b",{children:c.remainingMatches}),(f=c.plan)!=null&&f.supportAvailable?s.jsx("span",{style:{marginLeft:12},children:"Support included"}):null,s.jsx("button",{className:"btn primary",style:{marginLeft:12},onClick:()=>u("/dashboard/matches"),children:"Go to Matches"})]}):s.jsx("div",{className:"banner ghost",style:{marginBottom:16},children:"No active plan. Choose a plan below to join the next round."}),s.jsx("h2",{children:"Available Plans"}),P?s.jsx("div",{children:"Loading…"}):g.length===0?s.jsx("div",{className:"empty",children:"No active plans right now. Please check back later."}):s.jsx("div",{className:"grid cols-3",children:g.map(e=>{const a=x[p(e.id)],l=a==="pending",n=a==="approved";return s.jsxs("div",{className:"card plan",children:[s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h3",{children:e.name}),S(e.id)]}),s.jsxs("div",{className:"price",children:["₹",e.price??e.amount]}),s.jsxs("p",{className:"muted",children:["Includes ",e.matchQuota??e.quota??1," match",(e.matchQuota??e.quota??1)>1?"es":""]}),Array.isArray(e.offers)&&e.offers.length?s.jsx("ul",{style:{marginLeft:16},children:e.offers.map(i=>s.jsx("li",{children:i},i))}):null,e.supportAvailable?s.jsx("div",{className:"tag",style:{marginTop:8},children:"Support included"}):null]}),s.jsx("div",{className:"card-footer",children:n?s.jsx("button",{className:"btn",onClick:()=>u("/dashboard/matches"),children:"Go to Matches"}):s.jsx("button",{className:"btn btn-primary",onClick:()=>A(e),disabled:l,children:l?"Awaiting approval":"Choose plan"})})]},e.id)})})]})]})}export{U as default};
