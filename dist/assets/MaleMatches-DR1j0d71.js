import{u as q,a as A,r as i,j as a,N as B,e as k,q as d,w as l,c as m,d as h,f as u,h as F,b as w}from"./index-D1459Nzo.js";import{M as G}from"./MaleTabs-DW5qi8ga.js";import{C as S,P as M}from"./Carousel-DHp3MLYH.js";function $(){const{user:n}=q(),N=A(),[v,C]=i.useState([]),[f,I]=i.useState({}),[c,x]=i.useState([]),[r,y]=i.useState(0),E=i.useMemo(()=>new Set(c.map(e=>e.girlUid)),[c]);i.useEffect(()=>{if(!n)return;(async()=>{const s=await k(n.uid);y(s.remainingMatches??0);const p=d(m(h,"likes"),l("likedUserUid","==",n.uid)),o=(await u(p)).docs.map(t=>({id:t.id,...t.data()})),R=Array.from(new Set(o.map(t=>t.likingUserUid))),L=await Promise.all(R.map(async t=>(await u(d(m(h,"users"),l("uid","==",t)))).docs[0])),U={};for(const t of L)if(t){const g=t.data();U[g.uid]=g}const T=(await u(d(m(h,"matches"),l("participants","array-contains",n.uid)))).docs.map(t=>({id:t.id,...t.data()}));C(o),I(U),x(T)})()},[n]);const P=async e=>{try{await F({roundId:e.roundId,girlUid:e.likingUserUid}),w.success("Connection revealed to both of you!");const p=(await u(d(m(h,"matches"),l("participants","array-contains",n.uid)))).docs.map(o=>({id:o.id,...o.data()}));x(p);const b=await k(n.uid);y(b.remainingMatches??0)}catch(s){w.error(s.message??"Failed to confirm match")}},j=v.filter(e=>!E.has(e.likingUserUid));return a.jsxs(a.Fragment,{children:[a.jsx(B,{}),a.jsxs("div",{className:"container",children:[a.jsx(G,{}),a.jsxs("div",{className:`banner ${r===0?"ghost":""}`,style:{marginBottom:12,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:["Remaining matches: ",a.jsx("b",{children:r}),r===0?a.jsx("button",{className:"btn btn-primary",onClick:()=>N("/dashboard/plans"),children:"Buy again"}):null]}),a.jsx("h2",{children:"My Matches"}),a.jsx("h3",{style:{marginTop:12},children:"Pending Likes"}),j.length===0?a.jsx("div",{className:"empty",children:"No matches yet. When a girl likes your profile from a matching round, she will appear here."}):a.jsx(S,{children:j.map(e=>{const s=f[e.likingUserUid];return a.jsx(M,{photoUrl:s==null?void 0:s.photoUrl,name:"Hidden until matched",instagramId:void 0,bio:s==null?void 0:s.bio,interests:s==null?void 0:s.interests,footer:a.jsx("button",{className:"btn primary",onClick:()=>P(e),disabled:r<=0,children:r<=0?"Quota used":"Select & Reveal"})},e.id)})}),a.jsx("h3",{style:{marginTop:24},children:"Confirmed"}),c.length===0?a.jsx("div",{className:"empty",children:"No confirmed connections yet."}):a.jsx(S,{children:c.map(e=>{const s=f[e.girlUid];return s?a.jsx(M,{photoUrl:s.photoUrl,name:s.name,instagramId:s.instagramId,bio:s.bio,interests:s.interests},e.id):null})})]})]})}export{$ as default};
